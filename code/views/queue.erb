<% q = params[:name] %>
<h1>RQ : Queue [ <%= q %> ]</h1>

<ul>
<%  qc = RQ::QueueClient.new(q) %>
<li>
<span class=""> <a href="<%= "#{url}q/#{q}" %>"><%= "#{url}q/#{q}" %></a> </span>
<br />
<% if qc.running? %>
<% admin_status, oper_status = qc.status %>
  Status:
  Admin Status: <span class="<%= admin_status == "UP" ? "green" : "red" %>"> <%= admin_status %> </span>
  Oper Status: <span class="<%= oper_status == "UP" ? "green" : "red" %>"> <%= oper_status %> </span>
  <span class=""> <%=  qc.ping %> </span>
  <span class=""> <%=  qc.read_pid %> </span>
  up for <%= qc.uptime %> seconds
<% else %>
  Status: <span class="red">queue is COMPLETELY DOWN</span>
  <br />
  TODO: Display options, restarts
<% end %>
</li>
</ul>

<h3>Message List</h3>
<a href="<%= "#{url}q/#{q}/new_message" %>">New Message</a>
<br />
<% if RQ::QueueMgrClient.running? %>
<%   msgs = qc.messages %>
<span><%= msgs['prep'].length %> items in prep</span>
<br />
<span><%= msgs['run'].length %> items in run</span>
<br />
<span><%= msgs['pause'].length %> items in pause</span>
<br />
<span><%= msgs['done'] %> items in done</span>
<br />
<span><%= msgs['que'].length %> items in que</span>
<br />
<ul>
<%   msgs['que'].reverse.each do |msg| %>
<%     msg_id = "#{url}q/#{q}/#{msg[0]}" %>
<li>
  <span class="">
    <a href="<%= "#{url}q/#{q}/#{msg[0]}" %>"><%= "#{url}q/#{q}/#{msg[0]}" %></a>
  </span>
  <br />
  id: <span class=""> <%= msg[0] %></span>
  <% if q == 'relay' %>
    <%  ok, msg_full = qc.get_message({ 'msg_id' => msg[0]}) %>
    <% if ok == 'ok' %>
      dest: <span class="yellow"> <%= msg_full['dest'] %></span>
    <% end %>
  <% end %>
  : <span class="green"> <%= msg[1] %></span>
  <span class="">
    <form method="post" action="<%= "#{url}q/#{q}/#{msg[0]}" %>">
    <input name="_method" type="hidden" value="delete" />
    <button type="submit">Destroy it</button>
    </form>
  </span>
</form>
</li>
<%   end %>
<% end %>
</ul>

The bomb... <%= Time.now %> - <%= Dir.pwd %>
